{% extends "layout.twig" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Mi colección</h2>
</div>

<a href="videojuegos.php" class="btn btn-success mb-3">Añadir juegos</a>

{% if juegos is empty %}
    <p>No tienes juegos en tu colección todavía.</p>
{% else %}
<table class="table table-gamer">
    <tr>
        <th>Título</th>
        <th>Plataforma</th>
        <th>Género</th>
        <th>Estado</th>
        <th>Mi puntuación</th>
        <th>Media</th>
        <th>Acción</th>
    </tr>

    {% for j in juegos %}
    <tr>
        <td>{{ j.titulo }}</td>
        <td>{{ j.plataforma }}</td>
        <td>{{ j.genero }}</td>

        <!-- FORMULARIO DE ESTADO -->
        <td>
            <form method="post" action="update_estado.php">
                <input type="hidden" name="videojuego_id" value="{{ j.videojuego_id }}">
                <select name="estado" class="form-select form-select-sm">
                    <option value="jugando" {% if j.estado == 'jugando' %}selected{% endif %}>Jugando</option>
                    <option value="completado" {% if j.estado == 'completado' %}selected{% endif %}>Completado</option>
                </select>
                <button class="btn btn-primary btn-sm mt-1">Actualizar</button>
            </form>
        </td>

        <!-- FORMULARIO DE PUNTUACIÓN -->
        <td>
            <form method="post" action="update_puntuacion.php" class="d-flex gap-1">
                <input type="hidden" name="videojuego_id" value="{{ j.videojuego_id }}">
                <input type="number" name="puntuacion" min="1" max="10" value="{{ j.mi_puntuacion|default('') }}" class="form-control form-control-sm">
                <button class="btn btn-primary btn-sm">OK</button>
            </form>
        </td>

        <!-- MEDIA -->
        <td>{{ j.media_puntuacion|default('–') }}</td>

        <!-- ACCIÓN: ELIMINAR -->
        <td>
            <form method="post" action="delete_coleccion.php">
                <input type="hidden" name="videojuego_id" value="{{ j.videojuego_id }}">
                <button class="btn btn-danger btn-sm">Eliminar</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}
{% endblock %}